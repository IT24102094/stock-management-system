<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Reports - Stock Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #1a1d29;
            --bg-secondary: #2d3142;
            --bg-card: #252837;
            --cyan: #00d9ff;
            --orange: #ff9f43;
            --green: #10b981;
            --red: #ef4444;
            --yellow: #fbbf24;
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --border-color: #3d4252;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 13px;
        }

        /* Sidebar */
        .sidebar {
            min-height: 100vh;
            height: 100vh;
            background: var(--bg-secondary);
            color: white;
            position: fixed;
            width: 240px;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--orange);
        }

        .sidebar .brand {
            padding: 20px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar .brand h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .sidebar .nav-link {
            color: var(--text-secondary);
            padding: 10px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            margin: 3px 10px;
            font-size: 0.9rem;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: var(--text-primary);
            background-color: rgba(255, 165, 67, 0.15);
        }

        .sidebar .nav-link.active {
            border-left: 3px solid var(--orange);
        }

        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 240px;
            width: calc(100% - 240px);
            min-height: 100vh;
            padding: 2rem;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 1.5rem;
        }

        .breadcrumb-item a {
            color: var(--cyan);
            text-decoration: none;
        }

        .breadcrumb-item.active {
            color: var(--text-secondary);
        }

        /* Cards */
        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }

        .card-title {
            color: var(--text-primary);
            font-weight: 600;
        }

        .card-body {
            padding: 1.5rem;
        }

        .report-card {
            border-radius: 10px;
            transition: transform 0.3s;
            border: 1px solid var(--border-color);
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 217, 255, 0.2);
        }

        .report-card .report-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
        }

        /* Filter Section */
        .filter-section {
            background-color: var(--bg-card);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        /* Form Controls */
        .form-control, .form-select {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
        }

        .form-control:focus, .form-select:focus {
            background-color: var(--bg-secondary);
            border-color: var(--orange);
            color: var(--text-primary);
            box-shadow: 0 0 0 0.25rem rgba(255, 159, 67, 0.25);
        }

        .form-label {
            color: var(--text-primary);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--blue), #2563eb);
            border: none;
            color: white;
            font-weight: 500;
            padding: 8px 20px;
            border-radius: 8px;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--green), #059669);
            border: none;
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .btn-outline-secondary {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .btn-outline-secondary:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        /* Tables */
        .table {
            color: var(--text-primary);
        }

        .table thead th {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            font-weight: 600;
        }

        .table tbody td {
            color: var(--text-primary);
        }

        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .table tbody tr {
            border-bottom: 1px solid var(--border-color);
        }

        .table tbody tr:hover {
            background-color: rgba(255, 165, 67, 0.05);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }

        /* Alerts */
        .alert {
            border-radius: 8px;
            border: none;
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--red);
            border-left: 3px solid var(--red);
        }

        .lead {
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                min-height: auto;
                height: auto;
            }
            .main-content {
                margin-left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>

<!-- Fixed Sidebar -->
<div class="sidebar">
    <div class="brand">
        <h4><i class="fas fa-boxes"></i> Stock Management</h4>
    </div>
    <nav class="nav flex-column mt-3">
        <a href="/admin/dashboard" class="nav-link">
            <i class="fas fa-home"></i> Dashboard
        </a>
        <a href="/users" class="nav-link">
            <i class="fas fa-users"></i> User Management
        </a>
        <a href="/suppliers" class="nav-link">
            <i class="fas fa-truck"></i> Supplier Management
        </a>
        <a href="/staff" class="nav-link active">
            <i class="fas fa-user-tie"></i> Staff Management
        </a>
        <a href="/customers" class="nav-link">
            <i class="fas fa-user-friends"></i> Customers
        </a>
        <a href="/bills" class="nav-link">
            <i class="fas fa-file-invoice-dollar"></i> Bills
        </a>
        <a href="/items/dashboard" class="nav-link">
            <i class="fas fa-warehouse"></i> Inventory
        </a>
        <a href="/promotions" class="nav-link">
            <i class="fas fa-tags"></i> Promotions
        </a>
        <a href="/discounts" class="nav-link">
            <i class="fas fa-percent"></i> Discounts
        </a>
        <div class="nav-divider"></div>
        <a href="/logout" class="nav-link">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </nav>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Top Navigation -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>Staff Reports</h2>
            <p class="lead">Analytics and reports for staff management</p>
        </div>
        <div>
            <a href="/staff" class="btn btn-outline-secondary me-2">
                <i class="fas fa-arrow-left"></i> Back to Staff Management
            </a>
        </div>
    </div>
            
            <!-- Error message -->
            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${errorMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            
            <!-- Report Filter Form -->
            <div class="filter-section">
                <form action="/staff/reports/generate" method="GET" class="row g-3">
                    <div class="col-md-4">
                        <label for="startDate" class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="startDate" name="startDate" th:value="${startDate}">
                    </div>
                    <div class="col-md-4">
                        <label for="endDate" class="form-label">End Date</label>
                        <input type="date" class="form-control" id="endDate" name="endDate" th:value="${endDate}">
                    </div>
                    <div class="col-md-4">
                        <label for="department" class="form-label">Department</label>
                        <select class="form-select" id="department" name="department">
                            <option value="">All Departments</option>
                            <option value="Operations" th:selected="${department == 'Operations'}">Operations</option>
                            <option value="Warehouse" th:selected="${department == 'Warehouse'}">Warehouse</option>
                            <option value="Sales" th:selected="${department == 'Sales'}">Sales</option>
                            <option value="Finance" th:selected="${department == 'Finance'}">Finance</option>
                            <option value="IT" th:selected="${department == 'IT'}">IT</option>
                            <option value="HR" th:selected="${department == 'HR'}">HR</option>
                        </select>
                    </div>
                    <div class="col-12 text-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-chart-bar"></i> Generate Report
                        </button>
                        <a href="/staff/reports" class="btn btn-outline-secondary">
                            <i class="fas fa-redo"></i> Reset
                        </a>
                        <button type="button" class="btn btn-success" onclick="printReport()">
                            <i class="fas fa-print"></i> Print Report
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Report Header -->
            <div class="card mb-4">
                <div class="card-body">
                    <h4 style="color: var(--text-primary);">Staff Report</h4>
                    <p th:if="${reportData != null}" style="color: var(--text-primary);">
                        <strong>Period:</strong> <span th:text="${reportData.reportPeriod}">All time</span><br>
                        <strong>Generated on:</strong> <span th:text="${reportData.generatedAt}">2023-10-15</span>
                    </p>
                </div>
            </div>
            
            <!-- Key Metrics -->
            <div class="row">
                <div class="col-md-3">
                    <div class="card report-card">
                        <div class="card-body text-center">
                            <div class="card-title" style="color: var(--text-primary);">Total Staff</div>
                            <div class="report-value" style="color: var(--blue);" th:text="${reportData.totalStaff}">25</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card report-card">
                        <div class="card-body text-center">
                            <div class="card-title" style="color: var(--text-primary);">Active Staff</div>
                            <div class="report-value" style="color: var(--green);" th:text="${reportData.activeStaff}">22</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card report-card">
                        <div class="card-body text-center">
                            <div class="card-title" style="color: var(--text-primary);">Average Salary</div>
                            <div class="report-value" style="color: var(--cyan);" th:text="${reportData.averageSalary != null ? '$' + #numbers.formatDecimal(reportData.averageSalary, 1, 'COMMA', 2, 'POINT') : '$0.00'}">$52,500.00</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card report-card">
                        <div class="card-body text-center">
                            <div class="card-title" style="color: var(--text-primary);">Average Rating</div>
                            <div class="report-value" style="color: var(--yellow);" th:text="${reportData.averageRating != null ? #numbers.formatDecimal(reportData.averageRating, 1, 1) : '0.0'}">4.2</div>
                            <div class="small" th:if="${reportData.averageRating != null && reportData.averageRating > 0}">
                                <i class="fas fa-star" style="color: var(--yellow);" th:each="i : ${#numbers.sequence(1, reportData.averageRating.intValue())}"></i>
                                <i class="far fa-star" style="color: var(--yellow);" th:each="i : ${#numbers.sequence(reportData.averageRating.intValue() + 1, 5)}" th:if="${reportData.averageRating.intValue() < 5}"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Department Distribution</h5>
                            <div class="chart-container">
                                <canvas id="departmentChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Role Distribution</h5>
                            <div class="chart-container">
                                <canvas id="roleChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Department Table -->
            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title" style="color: var(--text-primary);">Department Breakdown</h5>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Department</th>
                                <th>Number of Staff</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="entry : ${reportData.departmentBreakdown}">
                                <td style="color: var(--text-primary);" th:text="${entry.key}">Operations</td>
                                <td style="color: var(--text-primary);" th:text="${entry.value}">10</td>
                                <td style="color: var(--text-primary);" th:text="${#numbers.formatDecimal(entry.value * 100 / reportData.totalStaff, 1, 1) + '%'}">40.0%</td>
                            </tr>
                            <tr th:if="${reportData.departmentBreakdown.isEmpty()}">
                                <td colspan="3" class="text-center" style="color: var(--text-secondary);">No department data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Role Table -->
            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title" style="color: var(--text-primary);">Role Breakdown</h5>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Role</th>
                                <th>Number of Staff</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="entry : ${reportData.roleBreakdown}">
                                <td style="color: var(--text-primary);" th:text="${entry.key}">Manager</td>
                                <td style="color: var(--text-primary);" th:text="${entry.value}">3</td>
                                <td style="color: var(--text-primary);" th:text="${#numbers.formatDecimal(entry.value * 100 / reportData.totalStaff, 1, 1) + '%'}">12.0%</td>
                            </tr>
                            <tr th:if="${reportData.roleBreakdown.isEmpty()}">
                                <td colspan="3" class="text-center" style="color: var(--text-secondary);">No role data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    // Get the report data from Thymeleaf
    const reportData = /*[[${reportData}]]*/ {};
    
    document.addEventListener('DOMContentLoaded', function() {
        // Department chart
        const departmentLabels = Object.keys(reportData.departmentBreakdown || {});
        const departmentCounts = Object.values(reportData.departmentBreakdown || {});
        
        if (departmentLabels.length > 0) {
            const departmentCtx = document.getElementById('departmentChart').getContext('2d');
            new Chart(departmentCtx, {
                type: 'pie',
                data: {
                    labels: departmentLabels,
                    datasets: [{
                        data: departmentCounts,
                        backgroundColor: [
                            '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796', '#5a5c69'
                        ],
                        hoverBackgroundColor: [
                            '#2e59d9', '#17a673', '#2c9faf', '#dda20a', '#be2617', '#60616f', '#373840'
                        ],
                        hoverBorderColor: "rgba(234, 236, 244, 1)",
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // Role chart
        const roleLabels = Object.keys(reportData.roleBreakdown || {});
        const roleCounts = Object.values(reportData.roleBreakdown || {});
        
        if (roleLabels.length > 0) {
            const roleCtx = document.getElementById('roleChart').getContext('2d');
            new Chart(roleCtx, {
                type: 'bar',
                data: {
                    labels: roleLabels,
                    datasets: [{
                        label: 'Number of Staff',
                        data: roleCounts,
                        backgroundColor: '#4e73df',
                        borderColor: '#4e73df',
                        borderWidth: 1
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
    });
    
    function printReport() {
        window.print();
    }
</script>
</body>
</html>